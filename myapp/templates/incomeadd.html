{% extends 'index.html' %}
{% block content %}
<div class="container-fluid">
  <section class="surface-card p-4 p-md-5 mb-4">
    <span class="metric-chip">{% if is_edit %}Income update{% else %}Income log{% endif %}</span>
    <h2 class="display-6 page-heading mt-3 mb-2">
      {% if is_edit %}
        Update income entry
      {% else %}
        Record a new income source
      {% endif %}
    </h2>
    <p class="page-subtext mb-0">
      {% if is_edit %}
        Adjust the details below to correct an earlier entry. Your dashboard updates automatically after saving.
      {% else %}
        Track every rupee of inflow to keep your plan balanced. The clearer the picture, the smarter the decisions.
      {% endif %}
    </p>
  </section>

  <div class="row g-4 justify-content-center align-items-stretch">
    <div class="col-xl-6 col-lg-7">
      <div class="card surface-card border-0">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div>
            <h4 class="mb-1">{% if is_edit %}Edit Income{% else %}Add Income{% endif %}</h4>
            <small class="text-muted">
              {% if is_edit %}
                Update the transaction so your records stay accurate.
              {% else %}
                Capture money coming in to balance your budget.
              {% endif %}
            </small>
          </div>
          <i class="fa-solid fa-hand-holding-dollar text-muted"></i>
        </div>
        <div class="card-body">
          {% if page_notice %}
            {% with level=page_notice_level|default:'success' %}
              <div class="alert surface-card alert-{{ level }} border-0 shadow-sm" role="alert">
                <i class="fa-solid {% if level == 'warning' %}fa-triangle-exclamation{% elif level == 'success' %}fa-circle-check{% else %}fa-circle-info{% endif %} me-2"></i>{{ page_notice }}
              </div>
            {% endwith %}
          {% endif %}
          {% if form_error %}
            <div class="alert surface-card alert-warning border-0 shadow-sm" role="alert">
              <i class="fa-solid fa-triangle-exclamation me-2"></i>{{ form_error }}
            </div>
          {% endif %}
          <form action="{{ form_action|default:'/incomesave' }}" method="post" class="row g-3" novalidate>
            {% csrf_token %}
            <div class="col-md-6">
              <label class="form-label fw-semibold text-muted" for="income_date">Date</label>
              <input type="date" class="form-control" id="income_date" name="date" value="{% if income %}{{ income.date|date:'Y-m-d' }}{% endif %}" required>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold text-muted" for="income_time">Time</label>
              <input type="time" class="form-control" id="income_time" name="time" value="{% if income %}{{ income.time|time:'H:i' }}{% endif %}" required>
            </div>
            <div class="col-12">
              <label class="form-label fw-semibold text-muted" for="income_remark">Remark</label>
              <input type="text" class="form-control" id="income_remark" name="remark" placeholder="e.g. Salary, Freelance project" value="{% if income %}{{ income.remark }}{% endif %}" required>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold text-muted" for="income_amount">Amount (Rs)</label>
              <input type="number" step="0.01" class="form-control" id="income_amount" name="amount" placeholder="0.00" value="{% if income %}{{ income.amount }}{% endif %}" required>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold text-muted" for="income_category">Category</label>
              <select class="form-select" id="income_category" name="category" required>
                <option value="" disabled {% if not income %}selected{% endif %}>Select category</option>
                <option value="salary" {% if income and income.category == 'salary' %}selected{% endif %}>Salary</option>
                <option value="bonus" {% if income and income.category == 'bonus' %}selected{% endif %}>Bonus</option>
                <option value="interest" {% if income and income.category == 'interest' %}selected{% endif %}>Interest</option>
                <option value="rental" {% if income and income.category == 'rental' %}selected{% endif %}>Rental Income</option>
                <option value="investments" {% if income and income.category == 'investments' %}selected{% endif %}>Investments</option>
                <option value="others" {% if income and income.category == 'others' %}selected{% endif %}>Others</option>
              </select>
            </div>
            <div class="col-12 d-grid">
              <button type="submit" class="btn btn-success btn-lg shadow-sm btn-icon">
                <i class="fa-solid {% if is_edit %}fa-pen-to-square{% else %}fa-plus-circle{% endif %} me-2"></i>
                {% if is_edit %}Update Income{% else %}Add Income{% endif %}
              </button>
            </div>
          </form>
        </div>
        <div class="card-footer border-0">
          <small class="text-muted">Income entries help you understand how much of the budget is backed by actual cash flow.</small>
        </div>
      </div>
    </div>
    <div class="col-xl-4 col-lg-5">
      <div class="card surface-card border-0 h-100">
        <div class="card-header">
          <h5 class="mb-1">Current overview</h5>
          <small class="text-muted">Updated with the latest entries.</small>
        </div>
        <div class="card-body d-flex flex-column gap-3">
          <div>
            <div class="text-uppercase small fw-semibold text-muted">This month</div>
            <div class="display-6 fw-bold text-success mt-1">Rs {{ monthly_income|default:0|floatformat:2 }}</div>
            <small class="text-muted">Total income logged for {{ current_month_label }}.</small>
          </div>
          <div>
            <div class="text-uppercase small fw-semibold text-muted">Monthly expenses</div>
            <div class="h4 mb-1 text-danger">Rs {{ monthly_expense|default:0|floatformat:2 }}</div>
            <small class="text-muted">Keep this lower than your inflow to grow savings.</small>
          </div>
          <div>
            <div class="text-uppercase small fw-semibold text-muted">Budget remaining</div>
            <div class="h4 mb-1{% if remaining_budget < 0 %} text-danger{% else %} text-primary{% endif %}">
              Rs {{ remaining_budget|default:0|floatformat:2 }}
            </div>
            <small class="text-muted">A positive number means you are ahead of plan.</small>
          </div>
        </div>
        <div class="card-footer border-0">
          <small class="text-muted">Need inspiration? Categorise income consistently to unlock richer charts.</small>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
