{% extends 'index.html' %}
{% block content %}
<div class="container-fluid">
  <section class="surface-card p-4 p-md-5 mb-4">
    <span class="metric-chip">{% if is_edit %}Expense update{% else %}Expense log{% endif %}</span>
    <h2 class="display-6 page-heading mt-3 mb-2">
      {% if is_edit %}
        Update expense entry
      {% else %}
        Capture a new expense
      {% endif %}
    </h2>
    <p class="page-subtext mb-0">
      {% if is_edit %}
        Adjust the details below to fix a previous record. We'll refresh your insights once you save.
      {% else %}
        Every entry sharpens your monthly insights. Keep an eye on the little spends to protect your savings goals.
      {% endif %}
    </p>
  </section>

  <div class="row g-4 justify-content-center align-items-stretch">
    <div class="col-xl-6 col-lg-7">
      <div class="card surface-card border-0">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div>
            <h4 class="mb-1">{% if is_edit %}Edit Expense{% else %}Add Expense{% endif %}</h4>
            <small class="text-muted">
              {% if is_edit %}
                Update the transaction so your expense trail stays accurate.
              {% else %}
                Log your spending to keep an eye on your monthly budget.
              {% endif %}
            </small>
          </div>
          <i class="fa-solid fa-receipt text-muted"></i>
        </div>
        <div class="card-body">
          {% if page_notice %}
            {% with level=page_notice_level|default:'success' %}
              <div class="alert surface-card alert-{{ level }} border-0 shadow-sm" role="alert">
                <i class="fa-solid {% if level == 'warning' %}fa-triangle-exclamation{% elif level == 'success' %}fa-circle-check{% else %}fa-circle-info{% endif %} me-2"></i>{{ page_notice }}
              </div>
            {% endwith %}
          {% endif %}
          {% if form_error %}
            <div class="alert surface-card alert-warning border-0 shadow-sm" role="alert">
              <i class="fa-solid fa-triangle-exclamation me-2"></i>{{ form_error }}
            </div>
          {% endif %}
          <form action="{{ form_action|default:'/ExpenceSAve' }}" method="post" class="row g-3" novalidate>
            {% csrf_token %}
            <div class="col-md-6">
              <label class="form-label fw-semibold text-muted" for="expense_date">Date</label>
              <input type="date" class="form-control" id="expense_date" name="date" value="{% if expense %}{{ expense.date|date:'Y-m-d' }}{% endif %}" required>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold text-muted" for="expense_time">Time</label>
              <input type="time" class="form-control" id="expense_time" name="time" value="{% if expense %}{{ expense.time|time:'H:i' }}{% endif %}" required>
            </div>
            <div class="col-12">
              <label class="form-label fw-semibold text-muted" for="expense_remark">Remark</label>
              <input type="text" class="form-control" id="expense_remark" name="remark" placeholder="e.g. Groceries, Uber ride" value="{% if expense %}{{ expense.remark }}{% endif %}" required>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold text-muted" for="expense_amount">Amount (Rs)</label>
              <input type="number" step="0.01" class="form-control" id="expense_amount" name="amount" placeholder="0.00" value="{% if expense %}{{ expense.amount }}{% endif %}" required>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold text-muted" for="expense_category">Category</label>
              <select class="form-select" id="expense_category" name="category" required>
                <option value="" disabled {% if not expense %}selected{% endif %}>Select category</option>
                <option value="food" {% if expense and expense.category == 'food' %}selected{% endif %}>Food &amp; Dining</option>
                <option value="rent" {% if expense and expense.category == 'rent' %}selected{% endif %}>Rent</option>
                <option value="travel" {% if expense and expense.category == 'travel' %}selected{% endif %}>Travel</option>
                <option value="fees" {% if expense and expense.category == 'fees' %}selected{% endif %}>Fees</option>
                <option value="entertainment" {% if expense and expense.category == 'entertainment' %}selected{% endif %}>Entertainment</option>
                <option value="utilities" {% if expense and expense.category == 'utilities' %}selected{% endif %}>Utilities</option>
                <option value="others" {% if expense and expense.category == 'others' %}selected{% endif %}>Others</option>
              </select>
            </div>
            <div class="col-12 d-grid">
              <button type="submit" class="btn btn-danger btn-lg shadow-sm btn-icon">
                <i class="fa-solid {% if is_edit %}fa-pen-to-square{% else %}fa-minus-circle{% endif %} me-2"></i>
                {% if is_edit %}Update Expense{% else %}Add Expense{% endif %}
              </button>
            </div>
          </form>
        </div>
        <div class="card-footer border-0">
          <small class="text-muted">
            Remaining budget after this entry: Rs {{ remaining_budget|default:0|floatformat:2 }}.
            Keep tracking to avoid overspending.
          </small>
        </div>
      </div>
    </div>
    <div class="col-xl-4 col-lg-5">
      <div class="card surface-card border-0 h-100">
        <div class="card-header">
          <h5 class="mb-1">Spending pulse</h5>
          <small class="text-muted">Stay mindful of where the money goes.</small>
        </div>
        <div class="card-body d-flex flex-column gap-3">
          <div>
            <div class="text-uppercase small fw-semibold text-muted">This month</div>
            <div class="display-6 fw-bold text-danger mt-1">Rs {{ monthly_expense|default:0|floatformat:2 }}</div>
            <small class="text-muted">Outflow logged for {{ current_month_label }}.</small>
          </div>
          <div>
            <div class="text-uppercase small fw-semibold text-muted">Monthly income</div>
            <div class="h4 mb-1 text-success">Rs {{ monthly_income|default:0|floatformat:2 }}</div>
            <small class="text-muted">Compare this with expenses to keep balance.</small>
          </div>
          <div>
            <div class="text-uppercase small fw-semibold text-muted">Budget remaining</div>
            <div class="h4 mb-1{% if remaining_budget < 0 %} text-danger{% else %} text-primary{% endif %}">
              Rs {{ remaining_budget|default:0|floatformat:2 }}
            </div>
            <small class="text-muted">Adjust the monthly budget on the dashboard if the target changes.</small>
          </div>
        </div>
        <div class="card-footer border-0">
          <small class="text-muted">Tip: Tag recurring expenses with the same category to spot patterns faster.</small>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
